#!/bin/sh

#
# V-I protocol
# Author: Daniele Linaro, April 2012
#

print_help()
{
    echo
    echo "V-I protocol"
    echo
    echo "Usage : `basename $0` [options <value>]"
    echo
    echo "where options are:"
    echo
    echo "   -h   display this help message and exit"
    echo "   -d   specify the directory where stimulus files are located"
    echo "   -n   specify number of batches (default 2)"
    echo "   -i   specify interval between individual trials in seconds (default 1)"
    echo "   -I   specify the input channel (default 0)"
    echo "   -O   specify the output channel (default 0)"
    echo
}

if [ -z "${PROTOCOLS_PATH:-}" ] ; then
    stimdir=$HOME/protocols/vi
else
    stimdir=$PROTOCOLS_PATH/vi
fi

trial_interval=1
reps=2
ai=0
ao=0
while getopts ":d:n:i:I:O:h" opt ; do
    case $opt in
	d)
	    if [ ! -d $OPTARG ] ; then
		echo "$OPTARG: no such directory."
		exit 1
	    fi
	    stimdir=$OPTARG
	    ;;
	n)
	    reps=$OPTARG
	    ;;
	i)
	    trial_interval=$OPTARG
	    ;;
	I)
	    ai=$OPTARG
	    ;;
	O)
	    ao=$OPTARG
	    ;;
	h)
	    print_help
	    exit 0
	    ;;
	\?)
	    echo "Invalid option: -$OPTARG."
	    echo "Type `basename $0` -h for help."
	    exit 1
	    ;;
    esac
done

lcg kernel -I $ai -O $ao
lcg vcclamp -D $stimdir -i $trial_interval -I $trial_interval -N $reps
